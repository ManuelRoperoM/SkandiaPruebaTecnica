CREATE TABLE "natural" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"tipo_documento_id" INTEGER NOT NULL,
	"numero_documento" INTEGER NOT NULL UNIQUE,
	"nombres" VARCHAR(255) NOT NULL,
	"apellidos" VARCHAR(255) NOT NULL,
	"departamento_residencia" VARCHAR(255) NOT NULL,
	"municipio_residencia" VARCHAR(255) NOT NULL,
	"persona_id" INTEGER,
	PRIMARY KEY("id")
);


CREATE TABLE "tipo_documento" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"tipo" VARCHAR(255) NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "juridica" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"nit" INTEGER NOT NULL,
	"razon_social" VARCHAR(255) NOT NULL,
	"tipo_empresa_id" INTEGER NOT NULL,
	"persona_id" INTEGER NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "tipo_empresa" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"tipo" VARCHAR(255) NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "composicion_accionaria" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"inversion" NUMERIC NOT NULL,
	"empresa_id" INTEGER NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "rol" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"rol" VARCHAR(255),
	PRIMARY KEY("id")
);


CREATE TABLE "persona" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"tipo_persona_id" INTEGER NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "tipo_persona" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"tipo" VARCHAR(255) NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "persona_rol" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"persona_id" INTEGER NOT NULL,
	"rol_id" INTEGER NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "empresa_representante" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"persona_id" INTEGER NOT NULL,
	"empresa_id" INTEGER NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "cuenta_ahorro" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"numero_cuenta" BIGINT NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"saldo_total" DECIMAL NOT NULL,
	"saldo_canje" DECIMAL NOT NULL,
	"saldo_disponible" DECIMAL NOT NULL,
	"cuenta_activa" BOOLEAN NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "ahorro_titular" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"ahorro_id" INTEGER,
	"persona_id" INTEGER,
	PRIMARY KEY("id")
);


CREATE TABLE "persona_composicion" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"persona_id" INTEGER NOT NULL,
	"composicion_accionaria_id" INTEGER,
	PRIMARY KEY("id")
);


CREATE TABLE "transaccion_ahorro" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"tipo_movimiento_id" INTEGER NOT NULL,
	"fecha" DATE NOT NULL,
	"valor" DECIMAL NOT NULL,
	"cuenta_id" INTEGER,
	PRIMARY KEY("id")
);


CREATE TABLE "movimiento_ahorro" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"tipo" VARCHAR(255),
	PRIMARY KEY("id")
);


CREATE TABLE "tarjeta_credito" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"franquicia_id" INTEGER NOT NULL,
	"numero" BIGINT NOT NULL UNIQUE,
	"cupo_aprovado" DECIMAL NOT NULL,
	"cupo_disponible" DECIMAL NOT NULL,
	"tarjeta_activa" BOOLEAN NOT NULL,
	"persona_id" INTEGER NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "franquicia" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"nombre" VARCHAR(255),
	PRIMARY KEY("id")
);


CREATE TABLE "transaccion_credito" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"tipo_movimiento_id" INTEGER NOT NULL,
	"fecha" DATE NOT NULL,
	"tarjeta_id" INTEGER NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "movimiento_credito" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"tipo" VARCHAR(255),
	PRIMARY KEY("id")
);


ALTER TABLE "natural"
ADD FOREIGN KEY("tipo_documento_id") REFERENCES "tipo_documento"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "juridica"
ADD FOREIGN KEY("tipo_empresa_id") REFERENCES "tipo_empresa"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "persona"
ADD FOREIGN KEY("tipo_persona_id") REFERENCES "tipo_persona"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "juridica"
ADD FOREIGN KEY("persona_id") REFERENCES "persona"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "persona_rol"
ADD FOREIGN KEY("rol_id") REFERENCES "rol"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "composicion_accionaria"
ADD FOREIGN KEY("empresa_id") REFERENCES "juridica"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "persona_composicion"
ADD FOREIGN KEY("persona_id") REFERENCES "persona"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "persona_composicion"
ADD FOREIGN KEY("composicion_accionaria_id") REFERENCES "composicion_accionaria"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "ahorro_titular"
ADD FOREIGN KEY("ahorro_id") REFERENCES "cuenta_ahorro"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "ahorro_titular"
ADD FOREIGN KEY("persona_id") REFERENCES "persona"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "transaccion_ahorro"
ADD FOREIGN KEY("cuenta_id") REFERENCES "cuenta_ahorro"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "transaccion_ahorro"
ADD FOREIGN KEY("tipo_movimiento_id") REFERENCES "movimiento_ahorro"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "transaccion_credito"
ADD FOREIGN KEY("tipo_movimiento_id") REFERENCES "movimiento_credito"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "tarjeta_credito"
ADD FOREIGN KEY("id") REFERENCES "persona"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "transaccion_credito"
ADD FOREIGN KEY("tarjeta_id") REFERENCES "tarjeta_credito"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;


-- Insercion de datos:

-- Insertar datos en tipo_documento
INSERT INTO "tipo_documento" ("tipo") VALUES
('Cédula de Ciudadanía'),
('Cédula de Extranjería'),
('Pasaporte');

-- Insertar datos en tipo_persona
INSERT INTO "tipo_persona" ("tipo") VALUES
('Natural'),
('Jurídica');

-- Insertar datos en persona
INSERT INTO "persona" ("tipo_persona_id") VALUES
(1), -- Natural
(1),
(2), -- Jurídica
(2); 

-- Insertar datos en natural
INSERT INTO "natural" ("tipo_documento_id", "numero_documento", "nombres", "apellidos", "departamento_residencia", "municipio_residencia", "persona_id") VALUES
(1, 123456789, 'Juan', 'Pérez', 'Cundinamarca', 'Bogotá', 1),
(2, 987654321, 'Ana', 'Gómez', 'Berlin', 'Alemania', 2);

-- Insertar datos en tipo_empresa
INSERT INTO "tipo_empresa" ("tipo") VALUES
('Sociedad Anónima'),
('Sociedad Limitada');

-- Insertar datos en juridica
INSERT INTO "juridica" ("nit", "razon_social", "tipo_empresa_id", "persona_id") VALUES
(800123456, 'Empresa S.A.', 1, 3),
(900654321, 'Comercial LTDA', 2, 4);

-- Insertar datos en rol
INSERT INTO "rol" ("rol") VALUES
('Administrador'),
('Cliente');

-- Insertar datos en persona_rol
INSERT INTO "persona_rol" ("persona_id", "rol_id") VALUES
(1, 1), -- Juan es Cliente
(2, 2),-- Ana es Administrador
(3, 2), --Empresa S.A. administrador
(4, 2); --Comercial LTDA administrador

-- Insertar datos en composicion_accionaria
INSERT INTO "composicion_accionaria" ("inversion", "empresa_id") VALUES
(1000000, 1), --Empresa S.A
(500000, 2);-- Comercial ltda

-- Insertar datos en persona_composicion
INSERT INTO "persona_composicion" ("persona_id", "composicion_accionaria_id") VALUES
(1, 1), -- Juan Accionista de Empresa S.A
(2, 2), -- Ana accionista de Comercial LTDA
(3, 2); -- Empresa S.A es accionista de comercial LTDA

-- Insertar datos en cuenta_ahorro
INSERT INTO "cuenta_ahorro" ("saldo_total", "saldo_canje", "saldo_disponible", "cuenta_activa") VALUES
(10000, 2000, 8000, TRUE),
(5000, 1000, 4000, TRUE);

-- Insertar datos en ahorro_titular
INSERT INTO "ahorro_titular" ("ahorro_id", "persona_id") VALUES
(1, 1),
(2, 2);

INSERT INTO "ahorro_titular" ("ahorro_id", "persona_id") VALUES
(2, 3);

-- Insertar datos en movimiento_ahorro
INSERT INTO "movimiento_ahorro" ("tipo") VALUES
('Depósito'),
('Retiro');

-- Insertar datos en transaccion_ahorro
INSERT INTO "transaccion_ahorro" ("tipo_movimiento_id", "fecha", "valor", "cuenta_id") VALUES
(1, '2025-01-01', 5000, 1),
(2, '2025-01-02', 2000, 2);

-- Insertar datos en franquicia
INSERT INTO "franquicia" ("nombre") VALUES
('Visa'),
('MasterCard');



-- Insertar datos en movimiento_credito
INSERT INTO "movimiento_credito" ("tipo") VALUES
('Compra'),
('Pago');

-- Insertar datos en tarjeta_credito
INSERT INTO "tarjeta_credito" ("franquicia_id", "numero", "cupo_aprovado", "cupo_disponible", "tarjeta_activa", "persona_id") VALUES
(1, 4111111111111111, 10000, 8000, TRUE, 1),
(2, 5111111111111111, 20000, 15000, TRUE, 2);
